<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HE Cut Pro v18 â€” Final Joint Cut</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    html,body{font-family:Cairo,system-ui,ui-sans-serif;}
    svg,svg *{user-select:none}
    body{min-height:100vh;transition:background .3s,color .3s}
    body.theme-dark{
      background:
        radial-gradient(circle at top left,rgba(56,189,248,.2),transparent 55%),
        radial-gradient(circle at bottom right,rgba(129,140,248,.25),#020617);
      color:#e5e7eb;
    }
    body.theme-light{background:#ffffff;color:#111827}
    .glass{backdrop-filter:blur(20px)}
    body.theme-dark .glass{background:rgba(15,23,42,.85);border-color:rgba(56,189,248,.3)}
    body.theme-light .glass{background:rgba(255,255,255,.9);border-color:#e5e7eb}
    input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:.5rem;border-radius:999px;background:#0f172a;outline:none}
    body.theme-light input[type=range]{background:#e5e7eb}
    input[type=range]::-webkit-slider-thumb{
      -webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:999px;
      background:#38bdf8;border:3px solid #fff;box-shadow:0 0 0 4px rgba(56,189,248,.5);cursor:pointer
    }
    .lang-btn{transition:all .2s ease}
    .lang-btn-active{transform:scale(1.1);box-shadow:0 0 0 3px rgba(56,189,248,.4)}
    .field-label-main{font-weight:600;font-size:.9rem}
    .field-label-sub{font-size:.7rem;opacity:.8}
  </style>
</head>
<body class="text-slate-100 theme-dark">

<header class="border-b border-slate-700/60 bg-slate-900/80 backdrop-blur sticky top-0 z-20">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
    <div>
      <h1 class="text-xl sm:text-2xl font-bold tracking-tight">
        <span data-i18n="appTitle">HE Cut Pro</span>
        <span class="text-sky-400 text-base align-middle">v18 â€” Final Joint Cut</span>
      </h1>
      <p class="text-xs sm:text-sm text-slate-400 mt-0.5" data-i18n="subtitle">
        Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ + Ø´ÙƒÙ„ Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ (Ø¨Ø¯ÙˆÙ† Ø®Ø·ÙˆØ· Ø­Ù…Ø±Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¬Ù…Ø¹)
      </p>
    </div>
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2 bg-slate-900/60 border border-slate-600/70 rounded-xl p-1 text-xs">
        <button class="lang-btn px-2 py-1 rounded-lg hover:bg-sky-500/20" data-lang="ar" title="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</button>
        <button class="lang-btn px-2 py-1 rounded-lg hover:bg-sky-500/20" data-lang="en" title="English">ğŸ‡ºğŸ‡¸ EN</button>
        <button class="lang-btn px-2 py-1 rounded-lg hover:bg-sky-500/20" data-lang="de" title="Deutsch">ğŸ‡©ğŸ‡ª DE</button>
      </div>
      <button id="themeToggle" class="w-9 h-9 rounded-full border border-slate-600 flex items-center justify-center text-lg bg-slate-900/70 hover:bg-slate-800" title="Toggle theme">â˜¾</button>
    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-6 sm:py-10 grid grid-cols-1 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1.1fr)] gap-6">

  <!-- SETTINGS -->
  <section class="glass rounded-2xl shadow-xl shadow-sky-950/50 border border-slate-700/70 p-4 sm:p-5">
    <h2 class="font-semibold text-lg sm:text-xl mb-4" data-i18n="panel1Title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª & Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
    <div class="grid grid-cols-2 gap-3 text-sm">

      <!-- series -->
      <label class="col-span-2 text-slate-300 flex flex-col gap-0.5">
        <span class="field-label-main" data-i18n="seriesLabel">Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ù‚Ø·Ø¹</span>
        <span class="field-label-sub text-sky-300/80">HEA / HEB / HEM</span>
      </label>
      <select id="series" class="col-span-2 rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2 focus:outline-none focus:ring-1 focus:ring-sky-400">
        <option value="HEA">HEA</option>
        <option value="HEB" selected>HEB</option>
        <option value="HEM">HEM</option>
      </select>

      <!-- size -->
      <label class="col-span-2 text-slate-300 mt-2 flex flex-col gap-0.5">
        <span class="field-label-main" data-i18n="sizeLabel">Ø§Ù„Ù…Ù‚Ø§Ø³</span>
        <span class="field-label-sub text-slate-400">HE 100 â€¦ HE 400</span>
      </label>
      <select id="size" class="col-span-2 rounded-lg border border-slate-700 bg-slate-900/70 px-3 py-2"></select>

      <!-- cut wings mode -->
      <label class="col-span-2 text-slate-300 mt-2 flex flex-col gap-0.5">
        <span class="field-label-main" data-i18n="cutWingsLabel">Ø§Ù„Ø£Ø¬Ù†Ø­Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
        <span class="field-label-sub text-slate-400" data-i18n="cutWingsHint">
          Ø§Ù„Ø²Ø§ÙˆÙŠØ© ØªØ£ØªÙŠ Ù…Ù† ÙØ±Ù‚ Ø§Ù„Ù‚Øµ Ø¨ÙŠÙ† Î”top Ùˆ Î”bottom
        </span>
      </label>
      <div class="col-span-2 flex flex-wrap gap-3 text-xs text-slate-200">
        <label><input type="radio" name="cutWings" value="top" checked> <span data-i18n="cutModeTop">Ù‚Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„ÙˆÙŠ</span></label>
        <label><input type="radio" name="cutWings" value="bottom"> <span data-i18n="cutModeBottom">Ù‚Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙÙ„ÙŠ</span></label>
        <label title="Ù‚ÙŠÙ… Ù…Ø®ØªÙ„ÙØ© Ù„Ù‚Øµ Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙˆØ§Ù„Ø³ÙÙ„ÙŠØŒ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù…Ù† Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ†Ù‡Ù…Ø§.">
          <input type="radio" name="cutWings" value="both"> <span data-i18n="cutModeBoth">Ù‚Øµ Ù…Ø³ØªÙ‚Ù„ Ù„Ù„Ø¬Ù†Ø§Ø­ÙŠÙ†</span>
        </label>
      </div>

      <!-- angle -->
      <label class="col-span-2 text-slate-300 mt-2 flex flex-col gap-0.5">
        <span class="field-label-main" data-i18n="angleLabel">Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Î¸ (Â°)</span>
        <span class="field-label-sub text-slate-400" data-i18n="angleHint">ØªØ³ØªØ®Ø¯Ù… Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ù‚Ø¯Ø§Ø± Ù‚Øµ ØªÙ‚Ø±ÙŠØ¨ÙŠ</span>
      </label>
      <div class="col-span-2 flex items-center gap-3">
        <input id="angleRange" type="range" min="1" max="45" step="0.5" value="30"/>
        <input id="angle" type="number" min="1" max="45" step="0.5" value="30" class="w-16 rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1 text-center"/>
      </div>

      <!-- cuts -->
      <label class="col-span-2 text-slate-300 mt-2 field-label-main" data-i18n="deltaSectionLabel">Ù‚Øµ Ø§Ù„Ø¬Ù†Ø§Ø­ Ù„ÙƒÙ„ Ù‚Ø·Ø¹Ø© (mm)</label>
      <div>
        <div class="text-xs text-slate-400 mb-1" data-i18n="deltaTopLabel">Î”top â€” Ù‚Øµ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø¹Ù„ÙˆÙŠ</div>
        <input id="deltaTop" type="number" min="0" step="0.1" value="0" class="w-full rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1 text-center"/>
        <input id="deltaTopRange" type="range" min="0" max="200" step="0.5" value="0" class="mt-1"/>
      </div>
      <div>
        <div class="text-xs text-slate-400 mb-1" data-i18n="deltaBottomLabel">Î”bottom â€” Ù‚Øµ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø³ÙÙ„ÙŠ</div>
        <input id="deltaBottom" type="number" min="0" step="0.1" value="0" class="w-full rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1 text-center"/>
        <input id="deltaBottomRange" type="range" min="0" max="200" step="0.5" value="0" class="mt-1"/>
      </div>

      <!-- visual tilt -->
      <label class="col-span-2 text-slate-300 mt-3 flex flex-col gap-0.5">
        <span class="field-label-main" data-i18n="slopeSectionLabel">Ù…ÙŠÙ„Ø§Ù† Ø®Ø· Ø§Ù„Ù‚Øµ ÙÙŠ Ø§Ù„Ø±Ø³Ù… (Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ)</span>
        <span class="field-label-sub text-amber-300" data-i18n="slopeSectionHint">Ù„Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø¨ØµØ±ÙŠ ÙÙ‚Ø· â€” Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
      </label>
      <div class="col-span-2 grid grid-cols-2 gap-3">
        <div>
          <div class="text-xs text-slate-400 mb-1" data-i18n="alphaTopTitle">Ø²Ø§ÙˆÙŠØ© Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ù„ÙˆÙŠ</div>
          <div class="flex items-center gap-2">
            <input id="alphaTopRange" type="range" min="0" max="60" step="1" value="0"/>
            <input id="alphaTop" type="number" min="0" max="60" step="1" value="0" class="w-14 rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1 text-center"/>
          </div>
        </div>
        <div>
          <div class="text-xs text-slate-400 mb-1" data-i18n="alphaBottomTitle">Ø²Ø§ÙˆÙŠØ© Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø®Ø· Ø§Ù„Ø³ÙÙ„ÙŠ</div>
          <div class="flex items-center gap-2">
            <input id="alphaBottomRange" type="range" min="0" max="60" step="1" value="0"/>
            <input id="alphaBottom" type="number" min="0" max="60" step="1" value="0" class="w-14 rounded-lg border border-slate-700 bg-slate-900/80 px-2 py-1 text-center"/>
          </div>
        </div>
      </div>

      <!-- tilt dir -->
      <label class="col-span-2 text-slate-300 mt-3 flex flex-col gap-0.5">
        <span class="field-label-main" data-i18n="tiltDirSectionLabel">Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ÙŠÙ„Ø§Ù† (Ø±Ø³Ù… ÙÙ‚Ø·)</span>
        <span class="field-label-sub text-slate-400" data-i18n="tiltDirSectionHint">Ù„Ø§ ÙŠØºÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©</span>
      </label>
      <div class="col-span-2 grid grid-cols-2 gap-3 text-xs text-slate-200">
        <div>
          <div class="mb-1 text-slate-400" data-i18n="tiltTopLabel">Ø§ØªØ¬Ø§Ù‡ Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø¹Ù„ÙˆÙŠ</div>
          <div class="flex gap-2">
            <label><input type="radio" name="tiltDirTop" value="in" checked> <span data-i18n="tiltIn">Ù†Ø­Ùˆ Ø§Ù„ÙˆØ³Ø·</span></label>
            <label><input type="radio" name="tiltDirTop" value="out"> <span data-i18n="tiltOut">Ø®Ø§Ø±Ø¬</span></label>
          </div>
        </div>
        <div>
          <div class="mb-1 text-slate-400" data-i18n="tiltBottomLabel">Ø§ØªØ¬Ø§Ù‡ Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø³ÙÙ„ÙŠ</div>
          <div class="flex gap-2">
            <label><input type="radio" name="tiltDirBottom" value="in" checked> <span data-i18n="tiltIn">Ù†Ø­Ùˆ Ø§Ù„ÙˆØ³Ø·</span></label>
            <label><input type="radio" name="tiltDirBottom" value="out"> <span data-i18n="tiltOut">Ø®Ø§Ø±Ø¬</span></label>
          </div>
        </div>
      </div>

    </div>

    <!-- readout -->
    <div class="mt-5 rounded-xl border border-slate-700/80 bg-slate-900/70 px-3.5 py-3 text-sm" id="readout"></div>

    <div class="mt-4">
      <button id="btnReset" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm border border-slate-600" data-i18n="resetBtn">
        Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·
      </button>
    </div>
    <p class="text-[11px] text-slate-400 mt-3" data-i18n="theoryText">
      Ø§Ù„ÙÙƒØ±Ø©: Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠÙ† Ù‚Ø·Ø¹ØªÙŠÙ† ØªØ£ØªÙŠ Ù…Ù† ÙØ±Ù‚ Ø§Ù„Ù‚Øµ Ø¨ÙŠÙ† Î”top Ùˆ Î”bottom. Ø¥Ø°Ø§ ÙƒØ§Ù†Ø§ Ù…ØªØ³Ø§ÙˆÙŠÙŠÙ† ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ â‡’ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù†Ø§ØªØ¬Ø© â‰ˆ 0Â°.
    </p>
  </section>

  <!-- DRAWINGS -->
  <section class="glass rounded-2xl shadow-xl shadow-sky-950/50 border border-slate-700/70 p-4 sm:p-5 flex flex-col">
    <h2 class="font-semibold text-lg sm:text-xl mb-4" data-i18n="panel2Title">Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ â€” Ù‚Ø·Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© + Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2>

    <!-- SINGLE PIECE FRONT -->
    <div class="border border-slate-700/70 rounded-2xl bg-slate-900/70 px-3 py-4 flex items-center justify-center">
      <div id="frontWrapper"></div>
    </div>
    <p class="text-[11px] text-slate-400 mt-2" data-i18n="frontHint">
      Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ Ù‡Ù†Ø§ ÙÙ‚Ø· Ù„ØªÙˆØ¶ÙŠØ­ Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù†Ø§Ø­ (Ø´ÙƒÙ„ ØªÙ…Ø«ÙŠÙ„ÙŠ).
    </p>

    <!-- PAIR JOINT -->
    <div class="mt-6">
      <h3 class="text-sm font-semibold text-slate-200 mb-3" data-i18n="pairTitle">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ù…Ø¹ â€” Ø´ÙƒÙ„ Ø­Ù‚ÙŠÙ‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ</h3>
      <div class="border border-slate-700/70 rounded-2xl bg-slate-900/70 px-3 py-3 flex items-center justify-center">
        <div id="pairWrapper" class="min-h-[210px] w-full flex items-center justify-center"></div>
      </div>
      <p class="text-[11px] text-slate-400 mt-2" data-i18n="pairHint">
        ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù‚Ø·Ø¹ØªØ§Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ù‚ØµØŒ ÙƒÙ„ Ù‚Ø·Ø¹Ø© ØªØ£Ø®Ø° Ø´ÙƒÙ„Ù‡Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŒ Ù…Ø¹ ØªÙ‚Ø§Ø±Ø¨ Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Øµ ÙˆÙØ±Ø§Øº ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù†Ø§Ø­ÙŠÙ†.
      </p>
    </div>
  </section>
</main>

<footer class="max-w-6xl mx-auto px-4 pb-6 text-[11px] text-slate-500 flex justify-between">
  <span data-i18n="footerLeft">HE Cut Pro v18 â€” Final Joint Cut</span>
  <span data-i18n="footerRight">Ù„Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠ: Ø§Ø¹ØªÙ…Ø¯ ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ ÙˆØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©.</span>
</footer>

<!-- I18N -->
<script>
  const I18N = {
    ar:{
      appTitle:"HE Cut Pro",
      subtitle:"Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ + Ø´ÙƒÙ„ Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ",
      panel1Title:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª & Ø§Ù„Ø­Ø³Ø§Ø¨",
      panel2Title:"Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ â€” Ù‚Ø·Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© + Ø§Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ",
      seriesLabel:"Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ù‚Ø·Ø¹",
      sizeLabel:"Ø§Ù„Ù…Ù‚Ø§Ø³",
      cutWingsLabel:"Ø§Ù„Ø£Ø¬Ù†Ø­Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨",
      cutWingsHint:"Ø§Ù„Ø²Ø§ÙˆÙŠØ© ØªØ£ØªÙŠ Ù…Ù† ÙØ±Ù‚ Ø§Ù„Ù‚Øµ Ø¨ÙŠÙ† Î”top Ùˆ Î”bottom",
      cutModeTop:"Ù‚Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„ÙˆÙŠ",
      cutModeBottom:"Ù‚Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙÙ„ÙŠ",
      cutModeBoth:"Ù‚Øµ Ù…Ø³ØªÙ‚Ù„ Ù„Ù„Ø¬Ù†Ø§Ø­ÙŠÙ†",
      angleLabel:"Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Î¸ (Â°)",
      angleHint:"ØªØ³ØªØ®Ø¯Ù… Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ù‚Ø¯Ø§Ø± Ù‚Øµ ØªÙ‚Ø±ÙŠØ¨ÙŠ",
      deltaSectionLabel:"Ù‚Øµ Ø§Ù„Ø¬Ù†Ø§Ø­ Ù„ÙƒÙ„ Ù‚Ø·Ø¹Ø© (mm)",
      deltaTopLabel:"Î”top â€” Ù‚Øµ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø¹Ù„ÙˆÙŠ",
      deltaBottomLabel:"Î”bottom â€” Ù‚Øµ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø³ÙÙ„ÙŠ",
      slopeSectionLabel:"Ù…ÙŠÙ„Ø§Ù† Ø®Ø· Ø§Ù„Ù‚Øµ ÙÙŠ Ø§Ù„Ø±Ø³Ù… (Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ)",
      slopeSectionHint:"Ù„Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø¨ØµØ±ÙŠ ÙÙ‚Ø· â€” Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨",
      alphaTopTitle:"Ø²Ø§ÙˆÙŠØ© Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ù„ÙˆÙŠ",
      alphaBottomTitle:"Ø²Ø§ÙˆÙŠØ© Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø®Ø· Ø§Ù„Ø³ÙÙ„ÙŠ",
      tiltDirSectionLabel:"Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù…ÙŠÙ„Ø§Ù† (Ø±Ø³Ù… ÙÙ‚Ø·)",
      tiltDirSectionHint:"Ù„Ø§ ÙŠØºÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©",
      tiltTopLabel:"Ø§ØªØ¬Ø§Ù‡ Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø¹Ù„ÙˆÙŠ",
      tiltBottomLabel:"Ø§ØªØ¬Ø§Ù‡ Ù…ÙŠÙ„Ø§Ù† Ø§Ù„Ø³ÙÙ„ÙŠ",
      tiltIn:"Ù†Ø­Ùˆ Ø§Ù„ÙˆØ³Ø·",
      tiltOut:"Ø®Ø§Ø±Ø¬",
      resetBtn:"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·",
      theoryText:"Ø§Ù„ÙÙƒØ±Ø©: Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠÙ† Ù‚Ø·Ø¹ØªÙŠÙ† ØªØ£ØªÙŠ Ù…Ù† ÙØ±Ù‚ Ø§Ù„Ù‚Øµ Ø¨ÙŠÙ† Î”top Ùˆ Î”bottom. Ø¥Ø°Ø§ ÙƒØ§Ù†Ø§ Ù…ØªØ³Ø§ÙˆÙŠÙŠÙ† ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ â‡’ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù†Ø§ØªØ¬Ø© â‰ˆ 0Â°.",
      frontHint:"Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ Ù‡Ù†Ø§ ÙÙ‚Ø· Ù„ØªÙˆØ¶ÙŠØ­ Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù†Ø§Ø­ (Ø´ÙƒÙ„ ØªÙ…Ø«ÙŠÙ„ÙŠ).",
      pairTitle:"Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ù…Ø¹ â€” Ø´ÙƒÙ„ Ø­Ù‚ÙŠÙ‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ",
      pairHint:"ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù‚Ø·Ø¹ØªØ§Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ù‚ØµØŒ ÙƒÙ„ Ù‚Ø·Ø¹Ø© ØªØ£Ø®Ø° Ø´ÙƒÙ„Ù‡Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŒ Ù…Ø¹ ØªÙ‚Ø§Ø±Ø¨ Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Øµ ÙˆÙØ±Ø§Øº ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù†Ø§Ø­ÙŠÙ†.",
      footerLeft:"HE Cut Pro v18 â€” Final Joint Cut",
      footerRight:"Ù„Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠ: Ø§Ø¹ØªÙ…Ø¯ ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ ÙˆØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©.",
      summaryTitle:"Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨",
      profileLabel:"Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„",
      flangeWidthLabel:"Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù†Ø§Ø­ b (ØªÙ‚Ø±ÙŠØ¨ÙŠ)",
      targetAngleLabel:"Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù‡Ø¯Ù (Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ·)",
      diffCutLabel:"Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù‚ØµÙŠÙ† |Î”top âˆ’ Î”bottom|",
      pairAngleLabel:"Ø²Ø§ÙˆÙŠØ© ØªØ¬Ù…ÙŠØ¹ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù…Ù† ÙØ±Ù‚ Ø§Ù„Ù‚Øµ",
      pairZeroNote:"â‰ˆ 0Â° (Ù„Ø£Ù† Î”top â‰ˆ Î”bottom)",
      remainingTopLabel:"Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙÙŠ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ",
      remainingBottomLabel:"Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙÙŠ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø³ÙÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ",
      pairAngleText:"Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø·Ø¹ØªÙŠÙ†:"
    },
    en:{
      appTitle:"HE Cut Pro",
      subtitle:"Front View + Final Joint Shape after Cutting",
      panel1Title:"Settings & Calculation",
      panel2Title:"Front View â€” Single Piece + Final Joint",
      seriesLabel:"Section Series",
      sizeLabel:"Size",
      cutWingsLabel:"Flanges Used in Calculation",
      cutWingsHint:"Angle comes from cut difference between Î”top and Î”bottom",
      cutModeTop:"Cut Top",
      cutModeBottom:"Cut Bottom",
      cutModeBoth:"Independent Cuts",
      angleLabel:"Target Assembly Angle Î¸ (Â°)",
      angleHint:"Used to suggest approximate cut value",
      deltaSectionLabel:"Flange Cut per Piece (mm)",
      deltaTopLabel:"Î”top â€” Top Flange Cut",
      deltaBottomLabel:"Î”bottom â€” Bottom Flange Cut",
      slopeSectionLabel:"Cut Line Tilt in Drawing (from vertical)",
      slopeSectionHint:"Visual only â€” does not affect calculation",
      alphaTopTitle:"Top Cut Line Tilt Angle",
      alphaBottomTitle:"Bottom Cut Line Tilt Angle",
      tiltDirSectionLabel:"Tilt Direction (drawing only)",
      tiltDirSectionHint:"Does not change geometry",
      tiltTopLabel:"Top Tilt Direction",
      tiltBottomLabel:"Bottom Tilt Direction",
      tiltIn:"Towards Center",
      tiltOut:"Outwards",
      resetBtn:"Reset",
      theoryText:"Idea: The assembly angle between two pieces comes from the cut difference between Î”top and Î”bottom. If they are almost equal â‡’ resulting angle â‰ˆ 0Â°.",
      frontHint:"Red lines here are only to show cut position on flange (illustrative).",
      pairTitle:"Result After Joining â€” Real Shape after Cutting",
      pairHint:"Two pieces after cutting, each takes its new shape, with a small approach at the cut point and a very small gap between flanges.",
      footerLeft:"HE Cut Pro v18 â€” Final Joint Cut",
      footerRight:"For execution: refer to section catalog & workshop instructions.",
      summaryTitle:"Calculation Summary",
      profileLabel:"Profile",
      flangeWidthLabel:"Flange width b (approx)",
      targetAngleLabel:"Target assembly angle (from slider)",
      diffCutLabel:"Cut difference |Î”top âˆ’ Î”bottom|",
      pairAngleLabel:"Approx. assembly angle from cut difference",
      pairZeroNote:"â‰ˆ 0Â° (because Î”top â‰ˆ Î”bottom)",
      remainingTopLabel:"Remaining width in top flange after cut",
      remainingBottomLabel:"Remaining width in bottom flange after cut",
      pairAngleText:"Approx. assembly angle between pieces:"
    },
    de:{
      appTitle:"HE Cut Pro",
      subtitle:"Nur Vorderansicht + endgÃ¼ltige FÃ¼gung nach dem Schnitt",
      panel1Title:"Einstellungen & Berechnung",
      panel2Title:"Vorderansicht â€” Einzelteil + FÃ¼gung",
      seriesLabel:"Profilserie",
      sizeLabel:"GrÃ¶ÃŸe",
      cutWingsLabel:"Flansche fÃ¼r Berechnung",
      cutWingsHint:"Winkel aus Schnittdifferenz Î”top und Î”bottom",
      cutModeTop:"Schnitt oben",
      cutModeBottom:"Schnitt unten",
      cutModeBoth:"UnabhÃ¤ngige Schnitte",
      angleLabel:"Zielmontagewinkel Î¸ (Â°)",
      angleHint:"Nur zur Vorschlag eines Schnittwertes",
      deltaSectionLabel:"Flanschschnitt pro Teil (mm)",
      deltaTopLabel:"Î”top â€” Oberer Flanschschnitt",
      deltaBottomLabel:"Î”bottom â€” Unterer Flanschschnitt",
      slopeSectionLabel:"Schnittlinienneigung in Zeichnung (von vertikal)",
      slopeSectionHint:"Nur visuell â€” Ã¤ndert Berechnung nicht",
      alphaTopTitle:"Neigungswinkel obere Schnittlinie",
      alphaBottomTitle:"Neigungswinkel untere Schnittlinie",
      tiltDirSectionLabel:"Neigungsrichtung (nur Zeichnung)",
      tiltDirSectionHint:"Ã„ndert Geometrie nicht",
      tiltTopLabel:"Neigungsrichtung oben",
      tiltBottomLabel:"Neigungsrichtung unten",
      tiltIn:"Zur Mitte",
      tiltOut:"Nach auÃŸen",
      resetBtn:"ZurÃ¼cksetzen",
      theoryText:"Idee: Der Montagewinkel zwischen zwei Teilen entsteht aus der Schnittdifferenz Î”top und Î”bottom. Wenn sie fast gleich sind â‡’ resultierender Winkel â‰ˆ 0Â°.",
      frontHint:"Rote Linien zeigen nur die Schnittposition am Flansch (Illustration).",
      pairTitle:"Ergebnis nach FÃ¼gen â€” reale Form nach dem Schnitt",
      pairHint:"Zwei Teile nach dem Schneiden, jedes nimmt seine neue Form an, mit leichter AnnÃ¤herung an der Schnittstelle und sehr kleinem Spalt zwischen den Flanschen.",
      footerLeft:"HE Cut Pro v18 â€” Final Joint Cut",
      footerRight:"FÃ¼r AusfÃ¼hrung: Profilkatalog & Werkstatt beachten.",
      summaryTitle:"BerechnungsÃ¼bersicht",
      profileLabel:"Profil",
      flangeWidthLabel:"Flanschbreite b (ca.)",
      targetAngleLabel:"Zielmontagewinkel (vom Schieber)",
      diffCutLabel:"Schnittdifferenz |Î”top âˆ’ Î”bottom|",
      pairAngleLabel:"Ca. Montagewinkel aus Schnittdifferenz",
      pairZeroNote:"â‰ˆ 0Â° (weil Î”top â‰ˆ Î”bottom)",
      remainingTopLabel:"Verbleibende Breite im oberen Flansch nach Schnitt",
      remainingBottomLabel:"Verbleibende Breite im unteren Flansch nach Schnitt",
      pairAngleText:"UngefÃ¤hrer Montagewinkel zwischen den Teilen:"
    }
  };
</script>

<!-- LOGIC -->
<script>
  const HE_DATA={
    HEA:{100:{b:100},120:{b:120},140:{b:140},160:{b:160},180:{b:180},200:{b:200},220:{b:220},240:{b:240},260:{b:260},280:{b:280},300:{b:300},320:{b:300},340:{b:300},360:{b:300},400:{b:300}},
    HEB:{100:{b:100},120:{b:120},140:{b:140},160:{b:160},180:{b:180},200:{b:200},220:{b:220},240:{b:240},260:{b:260},280:{b:280},300:{b:300},320:{b:300},340:{b:300},360:{b:300},400:{b:300}},
    HEM:{100:{b:120},120:{b:120},140:{b:140},160:{b:160},180:{b:180},200:{b:200},220:{b:220},240:{b:240},260:{b:260},280:{b:260},300:{b:300},320:{b:300},340:{b:300},360:{b:300},400:{b:300}}
  };
  const CALIB=1.0339;
  const GAP_MM=0.003; // gap Ù†Ø¸Ø±ÙŠ ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹

  const $series=document.getElementById('series');
  const $size=document.getElementById('size');
  const $angle=document.getElementById('angle');
  const $angleRange=document.getElementById('angleRange');
  const $deltaTop=document.getElementById('deltaTop');
  const $deltaBottom=document.getElementById('deltaBottom');
  const $deltaTopRange=document.getElementById('deltaTopRange');
  const $deltaBottomRange=document.getElementById('deltaBottomRange');
  const $alphaTop=document.getElementById('alphaTop');
  const $alphaTopRange=document.getElementById('alphaTopRange');
  const $alphaBottom=document.getElementById('alphaBottom');
  const $alphaBottomRange=document.getElementById('alphaBottomRange');
  const $readout=document.getElementById('readout');
  const $frontWrapper=document.getElementById('frontWrapper');
  const $pairWrapper=document.getElementById('pairWrapper');
  const $btnReset=document.getElementById('btnReset');
  const $themeToggle=document.getElementById('themeToggle');
  const $langButtons=document.querySelectorAll('.lang-btn');

  let mode='angle';
  let currentLang='ar';

  function getCutMode(){
    return document.querySelector('input[name="cutWings"]:checked')?.value || 'top';
  }
  function getTiltDirTop(){
    const c=document.querySelector('input[name="tiltDirTop"]:checked');
    return c?c.value:'in';
  }
  function getTiltDirBottom(){
    const c=document.querySelector('input[name="tiltDirBottom"]:checked');
    return c?c.value:'in';
  }
  function populateSizes(){
    const s=$series.value;
    const sizes=Object.keys(HE_DATA[s]).map(Number).sort((a,b)=>a-b);
    $size.innerHTML=sizes.map(v=>`<option value="${v}" ${v===180?'selected':''}>${v}</option>`).join('');
  }
  function angleFromCuts(dt,db,b){
    if(b<=0)return 0;
    const diff=Math.abs(dt-db);
    if(diff<0.001)return 0;
    return 2*Math.atan(diff/(b*CALIB))*180/Math.PI;
  }

  function applyTranslations(lang){
    currentLang=lang;
    const dict=I18N[lang]||I18N.ar;
    document.documentElement.lang=lang;
    document.documentElement.dir=(lang==='ar')?'rtl':'ltr';
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const k=el.getAttribute('data-i18n');
      if(dict[k]) el.innerHTML=dict[k];
    });
    $langButtons.forEach(btn=>{
      btn.classList.toggle('lang-btn-active',btn.dataset.lang===lang);
    });
    calc();
  }

  function calc(){
    const dict=I18N[currentLang]||I18N.ar;
    const s=$series.value;
    const sz=Number($size.value);
    const cutMode=getCutMode();
    const tiltDirTop=getTiltDirTop();
    const tiltDirBottom=getTiltDirBottom();
    const data=HE_DATA[s][sz]||{b:180};
    const b=data.b;

    const maxCut=Math.round(b*0.6);
    $deltaTopRange.max=maxCut;
    $deltaBottomRange.max=maxCut;

    let angDeg=Number($angle.value);
    let dt=Number($deltaTop.value);
    let db=Number($deltaBottom.value);
    let alphaTopDeg=Number($alphaTop.value);
    let alphaBottomDeg=Number($alphaBottom.value);
    if(isNaN(dt))dt=0;if(isNaN(db))db=0;
    if(isNaN(alphaTopDeg))alphaTopDeg=0;if(isNaN(alphaBottomDeg))alphaBottomDeg=0;

    alphaTopDeg=Math.max(0,Math.min(60,alphaTopDeg));
    alphaBottomDeg=Math.max(0,Math.min(60,alphaBottomDeg));
    $alphaTop.value=alphaTopDeg.toFixed(0);
    $alphaTopRange.value=alphaTopDeg;
    $alphaBottom.value=alphaBottomDeg.toFixed(0);
    $alphaBottomRange.value=alphaBottomDeg;

    if(mode==='angle'){
      if(!isFinite(angDeg)||angDeg<1)angDeg=1;
      if(angDeg>45)angDeg=45;
      const halfRad=(angDeg*Math.PI/180)/2;
      const deltaGeom=Math.min(maxCut,b*Math.tan(halfRad)*CALIB);
      if(cutMode==='top'){dt=deltaGeom;db=0;}
      else if(cutMode==='bottom'){dt=0;db=deltaGeom;}
      else {dt=deltaGeom;db=0;}
    }else{
      dt=Math.max(0,Math.min(dt,maxCut));
      db=Math.max(0,Math.min(db,maxCut));
      angDeg=Math.min(45,Math.max(0,angleFromCuts(dt,db,b)));
    }

    $angle.value=angDeg.toFixed(1);
    $angleRange.value=angDeg;
    $deltaTop.value=dt.toFixed(1);
    $deltaBottom.value=db.toFixed(1);
    $deltaTopRange.value=dt;
    $deltaBottomRange.value=db;

    const pairAngle=angleFromCuts(dt,db,b); // Ø²Ø§ÙˆÙŠØ© Ù…Ù† ÙØ±Ù‚ Ø§Ù„Ù‚Øµ ÙÙ‚Ø·
    const remainingTop=Math.max(b-dt,0);
    const remainingBottom=Math.max(b-db,0);
    const diffCut=Math.abs(dt-db);

    const sumTitle=dict.summaryTitle;
    $readout.innerHTML=`
      <div class="text-sky-300 text-xs mb-1">${sumTitle}</div>
      <div class="grid grid-cols-2 gap-x-3 gap-y-1 text-xs">
        <div>${dict.profileLabel}:</div><div class="text-right"><b>${s} ${sz}</b></div>
        <div>${dict.flangeWidthLabel}:</div><div class="text-right"><b>${b.toFixed(0)} mm</b></div>
        <div>${dict.targetAngleLabel}:</div><div class="text-right text-sky-300"><b>${angDeg.toFixed(2)}Â°</b></div>
        <div>Î”top:</div><div class="text-right text-emerald-300"><b>${dt.toFixed(1)} mm</b></div>
        <div>Î”bottom:</div><div class="text-right text-emerald-300"><b>${db.toFixed(1)} mm</b></div>
        <div>${dict.diffCutLabel}:</div><div class="text-right text-amber-300"><b>${diffCut.toFixed(1)} mm</b></div>
        <div>${dict.remainingTopLabel}:</div><div class="text-right"><b>${remainingTop.toFixed(1)} mm</b></div>
        <div>${dict.remainingBottomLabel}:</div><div class="text-right"><b>${remainingBottom.toFixed(1)} mm</b></div>
        <div>${dict.pairAngleLabel}:</div><div class="text-right text-sky-300"><b>${pairAngle===0?dict.pairZeroNote:pairAngle.toFixed(2)+'Â°'}</b></div>
      </div>
    `;

    renderFront({s,sz,b,angDeg,dt,db,alphaTopDeg,alphaBottomDeg,tiltDirTop,tiltDirBottom});
    renderJoint({s,sz,b,dt,db,alphaTopDeg,alphaBottomDeg,pairAngle});
  }

  function renderFront({s,sz,b,angDeg,dt,db,alphaTopDeg,alphaBottomDeg,tiltDirTop,tiltDirBottom}){
    const w=320,h=260,pad=30;
    const midX=w/2,topY=pad,botY=h-pad;
    const normH=200;
    const scale=Math.min(1.1,Math.max(0.7,sz/220));
    const ph=normH*scale;
    const th=Math.max(18,ph*0.18);
    const wh=Math.max(12,ph*0.12);
    const cy=(topY+botY)/2;
    const tfy=cy-ph/2,bfy=cy+ph/2;
    const halfSpan=70+(b-180)*0.25;
    const fl=midX-halfSpan,fr=midX+halfSpan;
    const fw=fr-fl;

    const ft=b>0?dt/b:0;
    const fb=b>0?db/b:0;
    const cutXTop=fr-ft*fw;
    const cutXBottom=fr-fb*fw;

    const phiTopRad=alphaTopDeg*Math.PI/180;
    const phiBottomRad=alphaBottomDeg*Math.PI/180;
    const dirSignTop=tiltDirTop==='in'?-1:1;
    const dirSignBottom=tiltDirBottom==='in'?-1:1;
    const dxTop=Math.tan(phiTopRad)*th*dirSignTop;
    const dxBottom=Math.tan(phiBottomRad)*th*dirSignBottom;

    const svg=`
    <svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
      <defs>
        <linearGradient id="metalGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#cbd5f5"/><stop offset="40%" stop-color="#e5e7eb"/>
          <stop offset="70%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#6b7280"/>
        </linearGradient>
        <linearGradient id="webGrad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#e5e7eb"/><stop offset="100%" stop-color="#9ca3af"/>
        </linearGradient>
        <filter id="shadowFront" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#020617" flood-opacity="0.8"/>
        </filter>
      </defs>
      <g filter="url(#shadowFront)">
        <rect x="${fl}" y="${tfy}" width="${fw}" height="${th}" fill="url(#metalGrad)" stroke="#94a3b8" stroke-width="1"/>
        <rect x="${fl}" y="${bfy-th}" width="${fw}" height="${th}" fill="url(#metalGrad)" stroke="#94a3b8" stroke-width="1"/>
        <rect x="${midX-wh/2}" y="${tfy+th}" width="${wh}" height="${ph-2*th}" fill="url(#webGrad)" stroke="#94a3b8" stroke-width="1"/>
      </g>
      ${dt>0.1?`<line x1="${cutXTop}" y1="${tfy}" x2="${cutXTop+dxTop}" y2="${tfy+th}" stroke="#f97373" stroke-width="4" stroke-linecap="round"/>`:''}
      ${db>0.1?`<line x1="${cutXBottom}" y1="${bfy-th}" x2="${cutXBottom+dxBottom}" y2="${bfy}" stroke="#f97373" stroke-width="4" stroke-linecap="round"/>`:''}
      <text x="${midX}" y="${tfy-12}" font-size="13" fill="#e5e7eb" text-anchor="middle" font-weight="600">${s} ${sz}</text>
      <text x="${midX}" y="${bfy+18}" font-size="11" fill="#fda4af" text-anchor="middle" font-weight="600">Î¸ (target) â‰ˆ ${angDeg.toFixed(1)}Â°</text>
    </svg>`;
    $frontWrapper.innerHTML=svg;
  }

  // Joint: Ù‚Ø·Ø¹ØªØ§Ù† Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ØŒ ÙƒÙ„ ÙˆØ§Ø­Ø¯Ø© Ù…Ù‚ØµÙˆØµØ© ÙØ¹Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¬Ù†Ø§Ø­
  function renderJoint({s,sz,b,dt,db,alphaTopDeg,alphaBottomDeg,pairAngle}){
    const w=500,h=220;
    const midY=h/2;
    const normH=170;
    const scale=Math.min(1.1,Math.max(0.7,sz/220));
    const ph=normH*scale;
    const th=Math.max(14,ph*0.17);
    const wh=Math.max(10,ph*0.11);
    const halfSpanBase=60+(b-180)*0.22;

    const gapPx=4; // gap ØµØºÙŠØ± Ø±Ù…Ø²ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø·Ø¹ØªÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø¹Ù„ÙˆÙŠ
    const midX=w/2;
    const leftMidX=midX- (halfSpanBase+wh+gapPx);
    const rightMidX=midX+ (halfSpanBase+wh+gapPx);

    const tfy=midY-ph/2;
    const bfy=midY+ph/2;

    function buildPiece(midX,opts){
      const {cutTop,cutBottom,alphaTopDeg,alphaBottomDeg,side} = opts;
      const halfSpan=halfSpanBase;
      const fl=midX-halfSpan;
      const fr=midX+halfSpan;
      const fw=fr-fl;

      const fracTop=b>0?cutTop/b:0;
      const fracBottom=b>0?cutBottom/b:0;
      const fracClampTop=Math.max(0,Math.min(0.5,fracTop));
      const fracClampBottom=Math.max(0,Math.min(0.5,fracBottom));

      const phiTopRad=alphaTopDeg*Math.PI/180;
      const phiBottomRad=alphaBottomDeg*Math.PI/180;

      const dirTop = side==='left' ? -1 : 1;   // Ø§Ù„Ù…ÙŠÙ„ Ù†Ø­Ùˆ Ø§Ù„Ø¯Ø§Ø®Ù„
      const dirBottom = side==='left' ? -1 : 1;

      const dxTop = Math.tan(phiTopRad)*th*dirTop;
      const dxBottom = Math.tan(phiBottomRad)*th*dirBottom;

      let pathTop, pathBottom;

      if(side==='left'){
        // Ù‚Øµ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ†
        const cutXTop = fr - fracClampTop*fw;
        const cutXBottom = fr - fracClampBottom*fw;

        pathTop = cutTop>0.1
          ? `M ${fl} ${tfy} L ${cutXTop} ${tfy} L ${cutXTop+dxTop} ${tfy+th} L ${fl} ${tfy+th} Z`
          : `M ${fl} ${tfy} L ${fr} ${tfy} L ${fr} ${tfy+th} L ${fl} ${tfy+th} Z`;

        pathBottom = cutBottom>0.1
          ? `M ${fl} ${bfy-th} L ${cutXBottom} ${bfy-th} L ${cutXBottom+dxBottom} ${bfy} L ${fl} ${bfy} Z`
          : `M ${fl} ${bfy-th} L ${fr} ${bfy-th} L ${fr} ${bfy} L ${fl} ${bfy} Z`;
      }else{
        //å³ Ù‚Ø·Ø¹Ù‡: Ù‚Øµ Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø±
        const cutXTop = fl + fracClampTop*fw;
        const cutXBottom = fl + fracClampBottom*fw;

        pathTop = cutTop>0.1
          ? `M ${cutXTop} ${tfy} L ${fr} ${tfy} L ${fr} ${tfy+th} L ${cutXTop+dxTop} ${tfy+th} Z`
          : `M ${fl} ${tfy} L ${fr} ${tfy} L ${fr} ${tfy+th} L ${fl} ${tfy+th} Z`;

        pathBottom = cutBottom>0.1
          ? `M ${cutXBottom} ${bfy-th} L ${fr} ${bfy-th} L ${fr} ${bfy} L ${cutXBottom+dxBottom} ${bfy} Z`
          : `M ${fl} ${bfy-th} L ${fr} ${bfy-th} L ${fr} ${bfy} L ${fl} ${bfy} Z`;
      }

      const webX = side==='left' ? (midX - wh/2) : (midX - wh/2);
      const web = `<rect x="${webX}" y="${tfy+th}" width="${wh}" height="${ph-2*th}" fill="url(#webGradJoint)" stroke="#94a3b8" stroke-width="1"/>`;

      return `
        <path d="${pathTop}" fill="url(#metalGradJoint)" stroke="#94a3b8" stroke-width="1"/>
        ${web}
        <path d="${pathBottom}" fill="url(#metalGradJoint)" stroke="#94a3b8" stroke-width="1"/>
      `;
    }

    const dict=I18N[currentLang]||I18N.ar;
    const angleText = pairAngle===0 ? dict.pairZeroNote : `${dict.pairAngleText} ${pairAngle.toFixed(2)}Â°`;

    const svg=`
    <svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
      <defs>
        <linearGradient id="metalGradJoint" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#cbd5f5"/><stop offset="40%" stop-color="#e5e7eb"/>
          <stop offset="70%" stop-color="#9ca3af"/><stop offset="100%" stop-color="#6b7280"/>
        </linearGradient>
        <linearGradient id="webGradJoint" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#e5e7eb"/><stop offset="100%" stop-color="#9ca3af"/>
        </linearGradient>
        <filter id="shadowJoint" x="-20%" y="-20%" width="140%" height="140%">
          <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#020617" flood-opacity="0.85"/>
        </filter>
      </defs>

      <g filter="url(#shadowJoint)">
        <!-- Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙŠØ³Ø±Ù‰: Ù‚Øµ ÙŠÙØ·Ø¨Ù‘Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø¹Ù„ÙˆÙŠ (Î”top) -->
        ${buildPiece(leftMidX,{cutTop:dt,cutBottom:0,alphaTopDeg:alphaTopDeg,alphaBottomDeg:0,side:'left'})}

        <!-- Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰: Ù‚Øµ ÙŠÙØ·Ø¨Ù‘Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù†Ø§Ø­ Ø§Ù„Ø³ÙÙ„ÙŠ (Î”bottom) -->
        ${buildPiece(rightMidX,{cutTop:0,cutBottom:db,alphaTopDeg:0,alphaBottomDeg:alphaBottomDeg,side:'right'})}
      </g>

      <!-- gap Ø±Ù…Ø²ÙŠ ØµØºÙŠØ± Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù†Ø§Ø­ÙŠÙ† Ø§Ù„Ø¹Ù„ÙˆÙŠÙŠÙ† -->
      <line x1="${leftMidX+halfSpanBase}" y1="${midY-ph/2}" x2="${rightMidX-halfSpanBase}" y2="${midY-ph/2}" stroke="#f97373" stroke-width="1" stroke-dasharray="3,3" opacity="0.6"/>

      <text x="${w/2}" y="22" font-size="13" fill="#e5e7eb" text-anchor="middle" font-weight="600">
        ${s} ${sz} â€” Joint After Cut (Front View)
      </text>
      <text x="${w/2}" y="${h-14}" font-size="10" fill="#cbd5f5" text-anchor="middle">
        ${angleText}
      </text>
    </svg>`;
    $pairWrapper.innerHTML=svg;
  }

  // EVENTS
  [$series,$size].forEach(el=>el.addEventListener('input',()=>{mode='angle';calc();}));
  $angle.addEventListener('input',()=>{mode='angle';calc();});
  $angleRange.addEventListener('input',()=>{$angle.value=$angleRange.value;mode='angle';calc();});

  $deltaTop.addEventListener('focus',e=>e.target.select());
  $deltaBottom.addEventListener('focus',e=>e.target.select());
  $deltaTop.addEventListener('change',()=>{mode='cuts';$deltaTopRange.value=$deltaTop.value||0;calc();});
  $deltaBottom.addEventListener('change',()=>{mode='cuts';$deltaBottomRange.value=$deltaBottom.value||0;calc();});
  $deltaTopRange.addEventListener('input',()=>{$deltaTop.value=$deltaTopRange.value;mode='cuts';calc();});
  $deltaBottomRange.addEventListener('input',()=>{$deltaBottom.value=$deltaBottomRange.value;mode='cuts';calc();});

  $alphaTop.addEventListener('input',()=>calc());
  $alphaTopRange.addEventListener('input',()=>{$alphaTop.value=$alphaTopRange.value;calc();});
  $alphaBottom.addEventListener('input',()=>calc());
  $alphaBottomRange.addEventListener('input',()=>{$alphaBottom.value=$alphaBottomRange.value;calc();});

  document.querySelectorAll('input[name="tiltDirTop"], input[name="tiltDirBottom"]').forEach(el=>{
    el.addEventListener('change',()=>calc());
  });
  document.querySelectorAll('input[name="cutWings"]').forEach(el=>{
    el.addEventListener('change',()=>{mode='angle';calc();});
  });

  $btnReset.addEventListener('click',()=>{
    mode='angle';
    $series.value='HEB';
    populateSizes();
    $size.value='180';
    $angle.value=30;$angleRange.value=30;
    $deltaTop.value=0;$deltaBottom.value=0;
    $deltaTopRange.value=0;$deltaBottomRange.value=0;
    $alphaTop.value=0;$alphaTopRange.value=0;
    $alphaBottom.value=0;$alphaBottomRange.value=0;
    document.querySelector('input[name="cutWings"][value="top"]').checked=true;
    document.querySelector('input[name="tiltDirTop"][value="in"]').checked=true;
    document.querySelector('input[name="tiltDirBottom"][value="in"]').checked=true;
    calc();
  });

  $themeToggle.addEventListener('click',()=>{
    document.body.classList.toggle('theme-dark');
    document.body.classList.toggle('theme-light');
    $themeToggle.textContent=document.body.classList.contains('theme-dark')?'â˜¾':'â˜€';
  });

  $langButtons.forEach(btn=>{
    btn.addEventListener('click',()=>applyTranslations(btn.dataset.lang));
  });

  document.addEventListener('DOMContentLoaded',()=>{
    populateSizes();
    $size.value='180';
    applyTranslations('ar');
  });
</script>

</body>
</html>
